# ç¬¬äºŒè¯¾

## Remix

[Remix IDE](http://remix.ethereum.org/)

### ç¼–è¯‘æ™ºèƒ½åˆçº¦

#### ç¼–è¯‘é¢ç‰ˆä»‹ç»

![](../img/06.png)

1. é€‰æ‹©ç¼–è¯‘å™¨ç‰ˆæœ¬, å¤§å¤šæ˜¯æ—¶å€™ IDE ä¼šæ ¹æ®æ–‡ä»¶å¤´éƒ¨çš„å£°æ˜è‡ªåŠ¨é€‰æ‹©

2. é€‰æ‹©è¦ç¼–è¯‘çš„è¯­è¨€, é»˜è®¤ Solidity å³å¯

3. æ ¹æ®ä»¥å¤ªåŠç¡¬åˆ†å‰é€‰æ‹© EVM çš„ç‰ˆæœ¬, æ¯ä¸ªç¡¬åˆ†å‰éƒ½ä¸º EVM å¢åŠ äº†æ–°çš„ç‰¹æ€§, å¦‚æœä¸æ˜¯æƒ³æµ‹è¯•æ—§ç‰ˆæœ¬çš„ EVM çš„è¯, é»˜è®¤ default å³å¯

4. æ˜¯å¦è‡ªåŠ¨ç¼–è¯‘, å‹¾é€‰çš„è¯, æ¯æ¬¡ä¿®æ”¹å®Œéƒ½ä¼šè‡ªåŠ¨ç¼–è¯‘ä¸€æ¬¡

5. æ˜¯å¦å¯ç”¨ç¼–è¯‘ä¼˜åŒ–ä»¥åŠç¼–è¯‘ä¼˜åŒ–ç­‰çº§, ä¸€èˆ¬é€‰ç”¨ 200 å³å¯, ä¼˜åŒ–åçš„åˆçº¦éƒ¨ç½²æˆæœ¬æ›´ä½

6. æ˜¯å¦å¿½ç•¥è­¦å‘Š

7. ç¼–è¯‘åˆçº¦

8. é€‰æ‹©è¦ç¼–è¯‘çš„åˆçº¦`åˆçº¦å(æ–‡ä»¶å.sol)`

9. æŸ¥çœ‹ç¼–è¯‘ç»†èŠ‚, è§[ç¼–è¯‘ç»†èŠ‚é¢æ¿ä»‹ç»](#ç¼–è¯‘ç»†èŠ‚é¢æ¿ä»‹ç»)

10. å¤åˆ¶åˆçº¦ ABI(Application Binary Interface), ABI æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ json, ä¸€èˆ¬ç”¨äºå¤–éƒ¨å’Œåˆçº¦äº¤äº’

11. å¤åˆ¶åˆçº¦å­—èŠ‚ç , å­—èŠ‚ç å°±æ˜¯åˆçº¦ç¼–è¯‘çš„ç»“æœ

#### ç¼–è¯‘ç»†èŠ‚é¢æ¿ä»‹ç»

![](../img/07.png)

ç¼–è¯‘ç»†èŠ‚é¢æ¿åŒ…å«è¯¸å¤šç»†èŠ‚, ä¸€èˆ¬åªéœ€è¦å…³å¿ƒ`FUNCTIONHASHES`, è¿™å°±æ˜¯ä¸Šä¸€è¯¾æ‰€è¯´çš„`function selector`.å¦‚æœæ‰‹åŠ¨ä¸åˆçº¦äº¤äº’, å¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ª

### éƒ¨ç½²ã€è°ƒè¯•æ™ºèƒ½åˆçº¦

#### éƒ¨ç½²ã€è°ƒè¯•é¢ç‰ˆä»‹ç»

![](../img/08.png)

1. é€‰æ‹©è¿è¡Œçš„ç½‘ç»œç¯å¢ƒ

   - JavaScript VM

     ä½¿ç”¨åœ¨æµè§ˆå™¨å†…å­˜ä¸­è¿è¡Œçš„ä¸€ä¸ªè™šæ‹Ÿçš„åŒºå—é“¾(æ¯å‘èµ·ä¸€ç¬”äº¤æ˜“, éƒ½ä¼šä¸ºå…¶ç”Ÿæˆä¸€ä¸ªæ–°çš„åŒºå—, ä½†æ™ºèƒ½åˆçº¦æ–¹é¢çš„è¡Œä¸ºä¸ EVM å®Œå…¨ä¸€è‡´)ä½œä¸ºè¿è¡Œç¯å¢ƒ. å¦‚æœé€‰æ‹©æ­¤é€‰é¡¹, `ACCOUNT`ä¸­ä¼šè‡ªåŠ¨ç”Ÿæˆè‹¥å¹²ä¸ªä½™é¢ä¸º 100 ETH çš„è´¦æˆ·ç”¨äºæµ‹è¯•

   - Injected Web3

     ä½¿ç”¨æµè§ˆå™¨ä¸­çš„ Web3 æ’ä»¶(ä¸€èˆ¬æ˜¯ MetaMask)å½“å‰çš„ç¯å¢ƒä½œä¸ºè¿è¡Œç¯å¢ƒ. æ¯”å¦‚, å¦‚æœè¦é“¾æ¥åˆ° GXChain2.0 çš„ Testnet, éœ€è¦å…ˆåœ¨ MetaMask ä¸­æ·»åŠ å¹¶åˆ‡æ¢åˆ°è‡ªå®šä¹‰ç½‘ç»œåœ°å€, ç„¶ååœ¨ Remix ä¸­é€‰æ‹© `Injected Web3`

   - Web3 Provider

     ä½¿ç”¨æ‰‹åŠ¨è¾“å…¥çš„ä»¥å¤ªåŠèŠ‚ç‚¹ RPC åœ°å€ä½œä¸ºè¿è¡Œç¯å¢ƒ, å¦‚ `http://127.0.0.1:8545`

2. é€‰æ‹©è°ƒç”¨åˆçº¦çš„è´¦æˆ·, ç‚¹å‡»åŠ å·å¯ä»¥å¢åŠ ä¸€ä¸ªè´¦æˆ·(åªåœ¨`JavaScript VM`æ—¶å¯ç”¨)

3. è®¾ç½®äº¤æ˜“çš„ `GasLimit`, æœ‰æ—¶å€™åˆçº¦éƒ¨ç½²å¤±è´¥, å¯èƒ½æ˜¯å› ä¸ºè¿™ä¸ªæ•°å€¼ä½äº†, éœ€è¦æ³¨æ„

4. è®¾ç½®äº¤æ˜“é™„å¸¦çš„è½¬è´¦é‡‘é¢åŠå•ä½, åªæœ‰ `payable` çš„æ–¹æ³•å¯ä»¥æ¥æ”¶è½¬è´¦, å¦‚æœä¸æ˜¯ `payable`, value å¿…é¡»ä¸º 0

5. é€‰æ‹©éœ€è¦éƒ¨ç½²çš„åˆçº¦`åˆçº¦å - æ–‡ä»¶å.sol`, å½“æ–‡ä»¶ä¸­æœ‰å¤šä¸ªåˆçº¦çš„æ—¶å€™, è¯·ç¡®è®¤åˆçº¦åå­—æ˜¯å¦æ˜¯è¦éƒ¨ç½²çš„åˆçº¦

6. éƒ¨ç½²åˆçº¦åˆ°å½“å‰çš„è¿è¡Œç¯å¢ƒ

7. å¦‚æœåˆçº¦å·²ç»éƒ¨ç½², å¯ä»¥å¡«å…¥åˆçº¦çš„åœ°å€, å¹¶ç‚¹å‡»`At Address`å³å¯

8. å·²éƒ¨ç½²çš„åˆçº¦åˆ—è¡¨, å¯ä»¥åœ¨æ­¤å¤„ä¸åˆçº¦äº¤äº’, è§[åˆçº¦äº¤äº’é¢æ¿ä»‹ç»](#åˆçº¦äº¤äº’é¢æ¿ä»‹ç»)

   - `ğŸ—‘ï¸`å¯ä»¥ç«‹å³æ¸…é™¤æ‰€æœ‰åˆçº¦

   - `x`æ¸…é™¤æŒ‡å®šçš„åˆçº¦

   - `ğŸ“‹`å¤åˆ¶åˆçº¦åœ°å€

9. å½“ä¸€ç¬”äº¤æ˜“å‘å‡ºå, å¯ä»¥åœ¨å‘½ä»¤è¡ŒæŸ¥çœ‹äº¤æ˜“çš„å…·ä½“å‚æ•°

#### åˆçº¦äº¤äº’é¢æ¿ä»‹ç»

![](../img/09.png)

1.  é»„è‰²æŒ‰é’®ä»£è¡¨æ­¤æ–¹æ³•ä¼šä¿®æ”¹ä»¥å¤ªåŠçŠ¶æ€æ ‘, éœ€è¦å‘èµ·ä¸€ç¬”äº¤æ˜“æ‰èƒ½è°ƒç”¨

2.  è“è‰²æŒ‰é’®ä»£è¡¨æ­¤æ–¹æ³•ä¸ä¼šä¿®æ”¹ä»¥å¤ªåŠçŠ¶æ€æ ‘, åªéœ€è¦è¿›è¡Œä¸€æ¬¡`CALL`å°±å¯ä»¥è°ƒç”¨

    - `ğŸ“‹`å¤åˆ¶åº•å±‚è°ƒç”¨å‚æ•°(`function selector` + è°ƒç”¨å‚æ•°)

3.  `CALL`çš„è¿”å›ç»“æœ`è¿”å›å‚æ•°ä¸‹æ ‡: ç±»å‹: å€¼`, åªæœ‰`CALL`å¹¶ä¸”æ–¹æ³•æœ‰è¿”å›å‚æ•°æ—¶, æ‰å¯ä»¥åœ¨è¿™é‡Œè·å–è¿”å›å‚æ•°. å‘èµ·äº¤æ˜“ä¸èƒ½è·å¾—åˆçº¦çš„è¿”å›å€¼. æ¯”å¦‚æœ‰ä¸€ä¸ªå‡½æ•°`function func() external pure returns(uint256, string memory);`, è°ƒç”¨ç»“æœå¯ä»¥æ˜¯

    ```
    0: uint256: 1
    1: string: xxx
    ```

## Hardhat

[Hardhat Document](https://hardhat.org/getting-started/)

ç¤ºä¾‹é¡¹ç›®: [hardhat-erc20-example](https://github.com/samlior/hardhat-erc20-example)

### Hardhat é¡¹ç›®æ„å»º

1. åˆå§‹åŒ–(å¯é€šè¿‡ Fork ç¤ºä¾‹é¡¹ç›®è·³è¿‡ä»¥ä¸‹æ­¥éª¤)

   1. `npm i -g hardhat`å®‰è£… hardhat

   2. ä½¿ç”¨åˆ›å»ºç›®å½•, å¹¶åœ¨æ–°ç›®å½•ä¸‹è¿è¡Œ`npx hardhat`, åˆå§‹åŒ–é¡¹ç›®

   3. `npm i prettier -D`å®‰è£… prettier, å¹¶é€šè¿‡`.prettierrc.js`é…ç½®

   4. é€šè¿‡`hardhat.config.js`é…ç½® hardhat

2. ç¼–å†™åˆçº¦(åœ¨ contracts ç›®å½•ä¸‹)

3. ç¼–å†™éƒ¨ç½²è„šæœ¬(åœ¨ deploy ç›®å½•ä¸‹)

   [ç¤ºä¾‹è„šæœ¬](https://github.com/samlior/hardhat-erc20-example/blob/master/deploy/MyERC20.js)

4. ç¼–å†™éœ€è¦çš„ä»»åŠ¡è„šæœ¬(åœ¨ tasks ç›®å½•ä¸‹)

   [ç¤ºä¾‹è„šæœ¬](https://github.com/samlior/hardhat-erc20-example/blob/master/tasks/index.js)

5. ç¼–å†™å•å…ƒæµ‹è¯•è„šæœ¬(åœ¨ test ç›®å½•ä¸‹)

   [ç¤ºä¾‹è„šæœ¬](https://github.com/samlior/hardhat-erc20-example/blob/master/test/MyERC20.js)

### Hardhat çš„ä½¿ç”¨

#### è®¾ç½®ç¯å¢ƒå˜é‡

```sh
# infura çš„ api key
export INFURA_API_KEY=xxx
# éƒ¨ç½²åˆçº¦çš„è´¦æˆ·çš„åŠ©è®°è¯
export MNEMONIC="test test test test test test test test test test test junk"
# éƒ¨ç½²åˆçº¦çš„è´¦æˆ·çš„åœ°å€, éœ€è¦å’ŒåŠ©è®°è¯åŒ¹é…
export DEV_ADDR=0x...abc
# etherscan çš„ api key, ç”¨äºéªŒè¯åˆçº¦
export ETHERSCAN_KEY=xxx
```

#### å®‰è£…ä¾èµ–

```sh
npm i
```

#### ç¼–è¯‘

```sh
npm run build
```

ä»¥ä¸Šå‘½ä»¤å®é™…ä¸Šè¿è¡Œçš„æ˜¯`npx hardhat compile`. è¿è¡Œå, hardhat ä¼šè‡ªåŠ¨åŠ è½½`hardhat.config.js`ä¸­çš„é…ç½®, å¯¹`contracts`ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¿›è¡Œç¼–è¯‘, ç¼–è¯‘åçš„ç»“æœ(åŒ…æ‹¬ ABI, å­—èŠ‚ç ç­‰)éƒ½å°†å­˜å‚¨åœ¨`artifacts`æ–‡ä»¶å¤¹ä¸‹. hardhat æä¾›äº†å„ç§æ–¹æ³•åŠ è½½åˆçº¦ ABI æˆ–å­—èŠ‚ç , å› æ­¤ä¸€èˆ¬ä¸éœ€è¦å…³å¿ƒ`artifacts`æ–‡ä»¶å¤¹ä¸‹çš„å…·ä½“å†…å®¹

#### éƒ¨ç½²

```sh
# éƒ¨ç½²åˆ°goerliæµ‹è¯•ç½‘ç»œ
npm run deploy:goerli
# éƒ¨ç½²åˆ°bsc
npm run deploy:bsc
# éƒ¨ç½²åˆ°æœ¬åœ°æµ‹è¯•èŠ‚ç‚¹
npm run node
```

`npm run deploy:goerli`å®é™…ä¸Šè¿è¡Œçš„æ˜¯`npx hardhat --network goerli deploy`, å…¶ä¸­

- `--network` å£°æ˜äº†ç½‘ç»œçš„åç§°(ç½‘ç»œä¿¡æ¯é…ç½®åœ¨`hardhat.config.js`ä¸­)
- `deploy` æ˜¯ hardhat å†…ç½®çš„ä¸€ä¸ªä»»åŠ¡, è°ƒç”¨ä»¥åä¼šè¿è¡Œ deploy ç›®å½•ä¸‹çš„æ‰€æœ‰è„šæœ¬

`npm run node`å®é™…ä¸Šè¿è¡Œçš„æ˜¯`npx hardhat node`, è¿™ä¸ªå‘½ä»¤ä¼šè®© hardhat åœ¨æœ¬åœ°è¿è¡Œä¸€ä¸ªè™šæ‹Ÿçš„åŒºå—é“¾, é»˜è®¤ç«¯å£æ˜¯ 8545, å¹¶ä¸”åœ¨åŒºå—é“¾å¼€å§‹è¿è¡Œçš„åŒæ—¶, ä¼šè¿è¡Œä¸€æ¬¡ deploy ä»»åŠ¡(ä¹Ÿå°±æ˜¯è¯´ä¼šæŠŠæ‰€æœ‰åˆçº¦éƒ¨ç½²å¥½)

åˆçº¦éƒ¨ç½²å®Œæˆå, ä¼šå°†åˆçº¦çš„åå­—ã€éƒ¨ç½²åçš„åœ°å€ç­‰ä¿¡æ¯æ”¾åœ¨`deployments`ç›®å½•ä¸‹, åªè¦ä¸åˆ é™¤æ­¤ç›®å½•ä¸‹çš„å†…å®¹, ä¹‹åå°±å¯ä»¥ç›´æ¥é€šè¿‡åˆçº¦çš„åå­—è·å–åˆçº¦åœ°å€, ABI ç­‰ä¿¡æ¯, æ¯”å¦‚

```js
task("balance:erc20", "Prints an account's ERC20 balance")
  .addParam("account", "User account")
  .setAction(async (taskArgs, { deployments, web3 }) => {
    // ...
    const { getArtifact, get } = deployments;
    // é€šè¿‡åˆçº¦åå­—è·å–åˆçº¦åœ°å€
    const addr = await get("MyERC20");
    const contract = new web3.eth.Contract(
      // é€šè¿‡åˆçº¦åå­—è·å–åˆçº¦ ABI, ç”¨äºåˆå§‹åŒ– web3 contract å¯¹è±¡
      (await getArtifact("MyERC20")).abi,
      addr,
      from
    );
    // ...
  });
```

#### è¿è¡Œä»»åŠ¡è„šæœ¬

ä»»åŠ¡è„šæœ¬å¯ä»¥å®Œæˆä¸€ç³»åˆ—é¢„è®¾çš„é€»è¾‘, é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿è¡Œ

```sh
npx hardhat --network networkName taskName --taskOption xxx
```

#### è¿è¡Œå•å…ƒæµ‹è¯•è„šæœ¬

```sh
npm run test
```

#### è®¤è¯åˆçº¦

**è®¤è¯åˆçº¦æ—¶, è¯·å…ˆç¡®ä¿å¯ä»¥æ­£å¸¸è®¿é—®[api.etherscan.io](https://api.etherscan.io)**

```sh
npx hardhat verify --network mainnet 0x...abc "LV Coin" "LV" "18"
```

å‚æ•°ä¾æ¬¡æ˜¯`åˆçº¦åœ°å€` `æ„é€ å‚æ•°1` `æ„é€ å‚æ•°2`, ä¸ç”¨å…³å¿ƒæ„é€ å‚æ•°çš„ç±»å‹, hardhat ä¼šè‡ªåŠ¨å¤„ç†
